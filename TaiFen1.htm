<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>东南沿海台风显示预警系统</title>
    <link href="css/ol.css" rel="stylesheet" type="text/css" />
	<link href="styles/style.css" rel="stylesheet" />
	<link href="css/style1.css" rel="stylesheet" type="text/css" />

    <script src="libs/ol5/ol.js"></script>
    <script src="libs/echarts.js"></script>
    <script src="js/tubiao.js"></script>
    <script src="js/plugins.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

    <script src="libs/turf.min.js"></script>
	<script src="js/plugins.min.js"></script>

	<!-- Footer Scripts
	============================================= -->
	<script src="js/functions.js"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="ttps://www.googletagmanager.com/gtag/js?id=UA-1478104-3"></script>
    <script src="js/main/main.js" ></script>
    <script src="js/main/main1.js" ></script>
    <script src="js/main/main2.js" ></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'UA-1478104-3');
	</script>
	<script>
		var _hmt = _hmt || [];
		(function () {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?f30e87151129552aea6e9c772b874692";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>
    <script src="js/windBaseData.js"></script>
    <script src="js/hello.js"></script>
</head>
<body>
    <div id="mapCon">
    </div>

    <!--    菜单-->
    <header id="header" >
	<div id="header-wrap">
    <div class="container size">
        <div class="header-row top-search-parent"

            <!-- Logo
						============================================= -->
            <div id="logo">
                <a href="#" >
                    <img src="/images/logo/typhoon1.png" alt="Tythoon Logo" style="height: 100px;">
                </a>
            </div>
            #logo end
            <div class="primary-menu">

                <ul class="menu-container">
                    <li class="menu-item" >
                        <a class="clickable" href="http://localhost:63342/Taifen/TaiFen1.htm">
                            <div style="font-size: 20px">首页</div>
                        </a>
                    </li>
                    <li class="menu-item ">
                        <a class="menu-link" href="#" style="" >
                            <div style="font-size: 20px">基本功能</div>
                        </a>
                        <ul class="sub-menu-container" style="display: none;">
                            <li class="menu-item" style="" >
                                <a class="menu-link" href="#" style="" onclick="localNow()">
                                    <div>定位当前位置</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link" href="#" onclick="draw2Cordon()">
                                    <div>显示警戒线</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link" href="#" onclick="littoral()">
                                    <div>添加东南沿海地区</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link" href="#" onclick="addGuangXi()">
                                    <div>添加广西</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link" href="#" onclick="DeleteLayers();">
                                    <div>清除图层</div>
                                </a>
                            </li>
                        </ul>
<!--                    <button class="sub-menu-trigger icon-chevron-right"></button></li>-->
                    </li>
                    <li class="menu-item ">
                        <a class="menu-link" href="#" style="" >
                            <div style="font-size: 20px">台风演示</div>
                        </a>
                        <ul class="sub-menu-container dark" style="display: none;">
                            <li class="menu-item" style="">
                                <a class="menu-link" href="#" style="" onclick="pathDemo()">
                                    <div>台风路径演示</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link" href="#" style="" onclick="bufferDemo()">
                                    <div>演示台风影响缓冲区</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item"  >
                        <a class="menu-link" href="#" style=""  onclick="">
                            <div style="font-size: 20px">台风分析</div>
                        </a>
                        <ul class="sub-menu-container" style="display: none;">
<!--                            <li class="menu-item" style="">-->
<!--                                <a class="menu-link" href="#" onclick="hide()">-->
<!--                                    <div>显示表格与图例</div>-->
<!--                                </a>-->
<!--                            </li>-->
<!--                            <li class="menu-item" style="">-->
<!--                                <a class="menu-link"  href="#" onclick="">-->
<!--                                    <div>台风路径演示</div>-->
<!--                                </a>-->
<!--                            </li>-->
                            <li class="menu-item" style="">
                                <a class="menu-link"  href="#" onclick="forecastDemo();">
                                    <div>预测23杜苏芮</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link"  href="" onclick="bufferAnalysis();">
                                    <div>可能受灾区域</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link"  href="#" onclick="nowData1();">
                                    <div>测试</div>
                                </a>
                            </li>
                            <li class="menu-item" style="">
                                <a class="menu-link"  href="#" onclick="nowData3();">
                                    <div>测试2</div>
                                </a>
                            </li>
                        </ul>

<!--                    <button class="sub-menu-trigger icon-chevron-right"></button>-->
                    </li>

                    <li class="menu-item">
                        <a class="menu-link" href="#" style="" onclick="maybeAreas()">
                            <div style="font-size: 20px">台风灾害预警</div>
                        </a>
                    </li>
					<li class="menu-item">
                        <a class="menu-link" href="#" style="" >
                            <div style="font-size: 20px">网页源代码</div>
                        </a>
						<ul class="sub-menu-container " style="display: none;">
                            <li class="menu-item" style="">
                                <a class="clickable" href="https://www.github.com" target="_blank">
                                    <div style="font-size: 24px">GitHub代码</div>
                                </a>
                            </li>
<!--                            <li class="menu-item" style="">-->
<!--                                <a class="menu-link" href="https://www.qq.com" target="_blank">-->
<!--                                    <div>其余网页代码</div>-->
<!--                                </a>-->
<!--                            </li>-->
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="#" style="" >
                            <input type="text" id="txt1" style="text-align: center;"  placeholder="历史台风搜索" onkeydown="handleKeyDown(event, this.value)" />
                        </a>
                    </li>
                </ul>

            </div>
             #primary-menu end
<!--        <form>-->
<!--        </form>-->
    </div>
        </div>




    </header>
    <!--    菜单结束-->
	<!-- 台风信息菜单 -->
    <div class="tfDiv">
    <!--        图例-->
        <div class="tuliDiv move">
            <div class="tuliHeader" onclick="tuli();">
                台风图例
            </div>
            <!-- 关闭的x-->
            <div class="closeDivTF">
                <div class="closeImgTF" id="closeFunTF"  onclick="hideTFContainer()"></div>
            </div>
            <div class="tuliContent" style="background: #DFDFDF;">
                <ul style="list-style-type: none; margin: 0; padding: 10px;">
                    <li style="background: url('libs/images/taifeng/Wind01.png') no-repeat;">超强台风</li>
                    <li style="background: url('libs/images/taifeng/Wind02.png') no-repeat;">强台风</li>
                    <li style="background: url('libs/images/taifeng/Wind03.png') no-repeat;">台风</li>
                    <li style="background: url('libs/images/taifeng/Wind04.png') no-repeat;">强热带风暴</li>
                    <li style="background: url('libs/images/taifeng/Wind05.png') no-repeat;">热带风暴</li>
                    <li style="background: url('libs/images/taifeng/Wind06.png') no-repeat;">热带气压</li>
                </ul>
            </div>
        </div>

<!--        台风信息目录-->
        <img src="images/other/导航.png" alt="右上角图片" class="right" onclick="hideTfDiv()">
        <img src="images/other/无台风1.png" alt="右上角图片" class="topright" onclick="hide1(this);">
        <div class="tfRightDiv move">
<!--            <img src="导航.png" alt="右上角图片" class="topright" onclick="hide1(this);">-->

            <div class="tfHeader">
                <span>台风列表</span>
            </div>
<!--            <div>-->
<!--            <input type="text" id="txt2" style="text-align: center;" placeholder="搜索内容" onclick="" />-->
<!--            </div>-->
            <div class="choiceDiv">
                <div class="tftjxzContent" id="tftjxzTab">
                    <table border="1"  >
                        <thead style="background-color: #7FCEFF;">
                        <tr>
                            <th>台风编号</th>
                            <th>台风名</th>
                            <th>英文名</th>
                        </tr>
                        </thead>
                        <tbody style="overflow-x: auto;">
                        <tr class = "a"  onclick="tfDemo()">
                            <td>202101</td>
                            <td>杜鹃</td>
                            <td>Dujuan</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tfHeader">
                台风路径
            </div>
            <div class="resDiv">
                <div class="tfljContent" id="tfljTab">
                    <table border="1">
                        <thead>
                        <tr>
                            <th>时间</th>
                            <th>风力</th>
                            <th>风速</th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="tfHeader">风速气压</div>
            <div class="tuDiv">
                <div id="main" > </div>
            </div>
            <div class="tfHeader">移动速度</div>
            <div class="tuDiv">
                <div id="main1" > </div>
            </div>
    </div>
    <!-- 台风信息菜单结束 -->
</body>
    <script type="text/javascript">
        littoral();
        draw2Cordon();
        tuliMove();
        nowData3();
        //坐标参考系
        var projection = ol.proj.get("EPSG:3857");
        //分辨率
        var resolutions = [];
        for (var i = 0; i < 19; i++) {
            resolutions[i] = Math.pow(2, 18 - i);
        }
        var tilegrid = new ol.tilegrid.TileGrid({
            origin: [0, 0],
            resolutions: resolutions
        });
        //拼接百度地图出图地址
        var baidu_source = new ol.source.TileImage({
            //设置坐标参考系
            projection: projection,
            //设置分辨率
            tileGrid: tilegrid,
            //出图基地址
            tileUrlFunction: function (tileCoord, pixelRatio, proj) {
                if (!tileCoord) {
                    return "";
                }
                var z = tileCoord[0];
                var x = tileCoord[1];
                var y = tileCoord[2];

                if (x < 0) {
                    x = "M" + (-x);
                }
                if (y < 0) {
                    y = "M" + (-y);
                }
                return "http://online3.map.bdimg.com/onlinelabel/?qt=tile&x=" + x + "&y=" + y + "&z=" + z + "&styles=pl&udt=20151021&scaler=1&p=1";
            }
        });
        //百度地图
        var baidu_layer = new ol.layer.Tile({
            source: baidu_source
        });
        //地图容器
		var map = new ol.Map({
            target: 'mapCon',
            layers: [baidu_layer],
            view: new ol.View({

                center: [12700000, 2700000],
                zoom: 6
            })
        });
		// 创建一个点
		var point = new ol.geom.Point([12700000, 2700000]); // 替换为你要显示的点的经纬度

		// 创建一个Feature，并设置其几何形状为刚才创建的点
		var feature = new ol.Feature({
			geometry: point
		});

		// 创建一个VectorSource，并添加Feature
		var vectorSource = new ol.source.Vector({
		features: [feature]
		});

		// 创建一个VectorLayer，并设置其数据源为刚才创建的VectorSource
		var vectorLayer = new ol.layer.Vector({
			source: vectorSource
		});

		// 将VectorLayer添加到地图上
		map.addLayer(vectorLayer);

		// 如果需要，可以为Feature添加一个样式
		feature.setStyle(new ol.style.Style({
			image: new ol.style.Circle({
			radius:3, // 点的半径
			fill: new ol.style.Fill({color: 'red'}) // 点的填充颜色
		})
		}));

        const ee = 0.00669342162296594323; // 偏心率平方，假设值
        const a = 6378245.0; // 地球长半轴，单位：米
        const PI = Math.PI; // 圆周率

        function wgs84ToGcj02(lng, lat) {
            if (out_of_china(lng, lat)) {
                return [lng, lat]
            } else {
                var dlat = transformlat(lng - 105.0, lat - 35.0)
                var dlng = transformlng(lng - 105.0, lat - 35.0)
                var radlat = lat / 180.0 * PI
                var magic = Math.sin(radlat)
                magic = 1 - ee * magic * magic
                var sqrtmagic = Math.sqrt(magic)
                dlat = (dlat * 180.0) / ((a * (1 - ee)) / (magic * sqrtmagic) * PI)
                dlng = (dlng * 180.0) / (a / sqrtmagic * Math.cos(radlat) * PI)
                var mglat = lat + dlat
                var mglng = lng + dlng
                return [mglng, mglat]
            }
        }
        function gcj02ToBd09(lng, lat) {
            //const x_PI = 0.000031830988618;
            const x_PI = 3.14159265358979324 * 3000.0 / 180.0;
            var z = Math.sqrt(lng * lng + lat * lat) + 0.00002 * Math.sin(lat * x_PI)
            var theta = Math.atan2(lat, lng) + 0.000003 * Math.cos(lng * x_PI)
            var bd_lng = z * Math.cos(theta) + 0.0065
            var bd_lat = z * Math.sin(theta) + 0.006
            return [bd_lng, bd_lat]
        }
        function transformlat(lng, lat) {
            var ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * Math.sqrt(Math.abs(lng))
            ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0
            ret += (20.0 * Math.sin(lat * PI) + 40.0 * Math.sin(lat / 3.0 * PI)) * 2.0 / 3.0
            ret += (160.0 * Math.sin(lat / 12.0 * PI) + 320 * Math.sin(lat * PI / 30.0)) * 2.0 / 3.0
            return ret
        }

        function transformlng(lng, lat) {
            var ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * Math.sqrt(Math.abs(lng))
            ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0
            ret += (20.0 * Math.sin(lng * PI) + 40.0 * Math.sin(lng / 3.0 * PI)) * 2.0 / 3.0
            ret += (150.0 * Math.sin(lng / 12.0 * PI) + 300.0 * Math.sin(lng / 30.0 * PI)) * 2.0 / 3.0
            return ret
        }

        // 判断是否在国内，不在国内则不做偏移
        function out_of_china(lng, lat) {
            return (lng < 72.004 || lng > 137.8347) || ((lat < 0.8293 || lat > 55.8271) || false)
        }
        function wgs84ToBd09(lng, lat){
            var gcj02 = wgs84ToGcj02(lng, lat);
            var bd09 = gcj02ToBd09(gcj02[0], gcj02[1]);
            return [bd09[0],bd09[1]];
        }
        // 使用示例
        // var wgs84Lng = 116.404;
        // var wgs84Lat = 39.915;
        // var gcj02 = wgs84ToGcj02(wgs84Lng, wgs84Lat);
        // console.log('gcj02 坐标:', gcj02);
        // var bd09 = wgs84ToGcj02(gcj02[0], gcj02[1]);
        // console.log('BD-09 坐标:', bd09);




    </script>
</body>
</html>
